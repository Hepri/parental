# Отладка Windows Parental Control Bot

## Новые возможности для отладки

Теперь приложение поддерживает несколько режимов запуска для удобной отладки:

### 1. Тестирование конфигурации (`-test`)

Проверяет конфигурацию без запуска сервиса:

```cmd
parental-control-bot.exe -test
```

**Что проверяется:**
- Существование файла `config.json`
- Корректность JSON структуры
- Наличие токена бота
- Количество авторизованных пользователей
- Количество детских аккаунтов
- Соединение с Telegram API

### 2. Отладочный режим (`-debug`)

Запускает приложение в консольном режиме для отладки:

```cmd
parental-control-bot.exe -debug
```

**Особенности отладочного режима:**
- Выводит подробную информацию о запуске
- Показывает статус всех компонентов
- Работает в консоли (не как сервис)
- Можно остановить через Ctrl+C
- Все логи выводятся в консоль

### 3. Интерактивный режим (по умолчанию)

Если запустить без параметров:

```cmd
parental-control-bot.exe
```

Показывает справку с доступными командами.

## Пошаговая диагностика

### Шаг 1: Проверка конфигурации

```cmd
parental-control-bot.exe -test
```

Если тест не проходит:
1. Убедитесь, что `config.json` существует
2. Проверьте JSON синтаксис
3. Убедитесь, что токен бота корректный
4. Проверьте интернет-соединение

### Шаг 2: Отладочный запуск

```cmd
parental-control-bot.exe -debug
```

Если отладочный режим не работает:
1. Проверьте права доступа к файлам
2. Убедитесь, что порты не заблокированы
3. Проверьте антивирус (может блокировать)

### Шаг 3: Проверка логов Windows

Если сервис не запускается:

1. **Event Viewer:**
   - `Win + R` → `eventvwr.msc`
   - `Windows Logs` → `Application`
   - Ищите события от "ParentalControlBot"

2. **Командная строка:**
   ```cmd
   sc query "Parental Control Bot Service"
   ```

3. **PowerShell:**
   ```powershell
   Get-WinEvent -FilterHashtable @{LogName='Application'; ProviderName='ParentalControlBot'}
   ```

## Частые проблемы и решения

### Проблема: "config.json not found"
**Решение:** Скопируйте `config.json.example` в `config.json` и настройте

### Проблема: "Telegram bot connection failed"
**Решения:**
- Проверьте токен бота
- Проверьте интернет-соединение
- Убедитесь, что бот не заблокирован

### Проблема: "Failed to initialize service"
**Решения:**
- Запустите от имени администратора
- Проверьте права доступа к файлам
- Проверьте антивирус

### Проблема: Сервис не запускается
**Решения:**
1. Проверьте Event Log
2. Запустите `-debug` для диагностики
3. Проверьте зависимости (Visual C++ Redistributable)

## Команды для управления сервисом

```cmd
# Установка сервиса
parental-control-bot.exe -install

# Удаление сервиса  
parental-control-bot.exe -uninstall

# Проверка статуса
sc query "Parental Control Bot Service"

# Запуск сервиса
sc start "Parental Control Bot Service"

# Остановка сервиса
sc stop "Parental Control Bot Service"
```

## Логирование

В отладочном режиме все логи выводятся в консоль. В режиме сервиса логи записываются в Windows Event Log.

Для просмотра логов сервиса:
```cmd
wevtutil qe Application /c:10 /rd:true /f:text /q:"*[System[Provider[@Name='ParentalControlBot']]]"
```
